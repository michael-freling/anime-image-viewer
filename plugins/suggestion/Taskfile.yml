version: "3"

vars:
  DATA_DIR: ./source
  PREPROCESSED_DIR: ./datasets
  MODEL_DIR: ./models

env:
  PYTHONPATH: ../plugins-protos/gen/python

tasks:
  setup:
    cmds:
      - python -m venv .venv
      - bash -c ". .venv/bin/activate && pip install -r requirements.txt"

  preprocess:
    cmds:
      - cmd: mv {{ .PREPROCESSED_DIR }} {{ .PREPROCESSED_DIR }}.bak
        ignore_error: true
      - python src/main.py preprocess {{ .DATA_DIR }} {{ .PREPROCESSED_DIR }}
      - zip -rq {{ .PREPROCESSED_DIR }}.zip {{ .PREPROCESSED_DIR }}

  train:
    cmds:
      - python src/main.py train {{ .PREPROCESSED_DIR }} {{ .MODEL_DIR }}

  server:
    cmds:
      - python src/main.py server {{ .MODEL_DIR }}
